<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: LNet Transport Core API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('da/d12/_l_net_core_d_l_d-fspec.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">LNet Transport Core API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="../../da/d12/_l_net_core_d_l_d-fspec.html#LNetCoreDLD-fspec-ovw">API Overview</a></li>
<li><a class="el" href="../../da/d12/_l_net_core_d_l_d-fspec.html#LNetCoreDLD-fspec-ds">API Data Structures</a></li>
<li><a class="el" href="../../da/d12/_l_net_core_d_l_d-fspec.html#LNetCoreDLD-fspec-subs">Subroutines</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html">LNet Transport Core Interfaces</a></li>
</ul>
<h1><a class="anchor" id="LNetCoreDLD-fspec-ovw"></a>
API Overview</h1>
<p>The LNet Transport Core presents an address space agnostic API to the LNet Transport layer. These interfaces are declared in the file <a class="el" href="../../d0/d25/lnet__core_8h.html">net/lnet/lnet_core.h</a>.</p>
<p>The interface is implemented differently in the kernel and in user space. The kernel interface interacts directly with LNet; the user space interface uses a device driver to communicate with its kernel counterpart and uses shared memory to avoid event data copy.</p>
<p>The Core API offers no callback mechanism. Instead, the transport must poll for events. Typically this is done on one or more dedicated threads, which exhibit the desired processor affiliation required by the higher software layers.</p>
<p>The following sequence diagram illustrates the typical operational flow: </p><div class="mscgraph">
<img src="../../msc_inline_mscgraph_9.png" alt="msc_inline_mscgraph_9" border="0" usemap="#msc_inline_mscgraph_9.map"/>
<map name="msc_inline_mscgraph_9.map" id="msc_inline_mscgraph_9.map"></map>
</div>
<h1><a class="anchor" id="LNetCoreDLD-fspec-ds"></a>
API Data Structures</h1>
<p>The API requires that the transport application maintain API defined shared data for various network related objects:</p><ul>
<li><a class="el" href="../../d8/d81/structnlx__core__domain.html">nlx_core_domain</a></li>
<li><a class="el" href="../../d3/d98/structnlx__core__transfer__mc.html">nlx_core_transfer_mc</a></li>
<li><a class="el" href="../../d7/df3/structnlx__core__buffer.html">nlx_core_buffer</a></li>
</ul>
<p>The sharing takes place between the transport layer and the core layer. This will span the kernel and user address space boundary when using the user space transport.</p>
<p>These shared data structures should be embedded in the transport application's own private data. This requirement results in an initialization call pattern that takes a pointer to the standard network layer data structure concerned and a pointer to the API's data structure.</p>
<p>Subsequent calls to the API only pass the API data structure pointer. The API data structure must be eventually finalized.</p>
<h1><a class="anchor" id="LNetCoreDLD-fspec-subs"></a>
Subroutines</h1>
<p>The API subroutines are described in <a class="el" href="../../d8/de0/group___l_net_core.html">LNet Transport Core Interfaces</a>. The subroutines are categorized as follows:</p>
<ul>
<li>Initialization, finalization, cancellation and query subroutines:<ul>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#gace66e8f4f8f06a32893bf65d62dfe62c">nlx_core_buf_deregister()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga449a802356f3257888fa265e54ca7671">nlx_core_buf_register()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga9a7243ef73c4d6b8c9ecf249adf54a69">nlx_core_dom_fini()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#gaa243e6da95eb97974854ef9289fc6b9e">nlx_core_dom_init()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga37e22cdabbaa6b9e7e868107b3b41b47">nlx_core_get_max_buffer_segment_size()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#gae50fbffe2aae4306c5796831b30fddce">nlx_core_get_max_buffer_size()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#gaceb7d73c016add28bb9a1fcfd74ae248">nlx_core_tm_start()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga1daa943c351d0635b82ff360220a2c6b">nlx_core_tm_stop()</a></li>
</ul>
These interfaces have names roughly similar to the associated <a class="el" href="../../da/dca/structm0__net__xprt__ops.html">m0_net_xprt_ops</a> method from which they are intended to be directly or indirectly invoked. Note that there are no equivalents for the <code>xo_tm_init()</code>, <code>xo_tm_fini()</code> and <code>xo_tm_confine()</code> calls.</li>
<li>End point address parsing subroutines:<ul>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#gadcf9e5c3e6a5615f874f8df656cc0298">nlx_core_ep_addr_decode()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga9fa65b9a7f3ca1f1a79066e731fddd2a">nlx_core_ep_addr_encode()</a></li>
</ul>
</li>
<li>Buffer operation related subroutines:<ul>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga5619b1f339a3cbef5fa223e3310b782f">nlx_core_buf_active_recv()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga08195a4254c9417921fc0c7ef494f176">nlx_core_buf_active_send()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga2349cab13ffd266d9b925a247ea551d7">nlx_core_buf_del()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga655b317917c79d041bdc3f76e3c4f1ad">nlx_core_buf_msg_recv()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga4ae290086ee385143d8eb657039c301a">nlx_core_buf_msg_send()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga5bbd8563af0761f06db4565040b196ee">nlx_core_buf_passive_recv()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#gadeb417efb52605322308c7f8f37efccb">nlx_core_buf_passive_send()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#gaf8b803bcbff74c0d50e0efaebfd5d5ea">nlx_core_buf_desc_encode()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga4af40934b690775bf5c1844e078e374c">nlx_core_buf_desc_decode()</a></li>
</ul>
The buffer operation initiation calls are all invoked in the context of the <a class="el" href="../../d9/dd2/group__net.html#gacce89dfe5af29f0c271b458408c6e57e">m0_net_buffer_add()</a> subroutine. All operations are immediately initiated in the Lustre LNet kernel module, though results will be returned asynchronously through buffer events.</li>
<li>Event processing calls:<ul>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#ga65ac578e7bf12c02ed940ecc76ab0c6f">nlx_core_buf_event_wait()</a></li>
<li><a class="el" href="../../d8/de0/group___l_net_core.html#gaea683e854b7a488bec4543247128289d">nlx_core_buf_event_get()</a></li>
</ul>
The API assumes that only a single transport thread will be used to process events.</li>
</ul>
<p>Invocation of the buffer operation initiation subroutines and the <a class="el" href="../../d8/de0/group___l_net_core.html#gaea683e854b7a488bec4543247128289d">nlx_core_buf_event_get()</a> subroutine should be serialized.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../db/dd7/_k_l_net_core_d_l_d.html">LNet Transport Kernel Core DLD</a> </dd>
<dd>
<a class="el" href="../../d8/d7d/_u_l_net_core_d_l_d.html">LNet Transport User Space Core DLD</a> </dd>
<dd>
<a class="el" href="../../da/d74/_l_net_d_r_v_d_l_d.html">LNet Transport Device DLD</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d3/dd6/_d_l_d_i_x.html">Detailed Designs</a></li><li class="navelem"><a class="el" href="../../d6/de0/_l_net_d_l_d.html">LNet Transport DLD</a></li>
    <li class="footer">Generated on Fri May 20 2022 10:35:33 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
