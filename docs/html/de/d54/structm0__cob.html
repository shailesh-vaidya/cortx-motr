<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: m0_cob Struct Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('de/d54/structm0__cob.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">m0_cob Struct Reference<div class="ingroups"><a class="el" href="../../d3/d8e/group__cob.html">Component objects</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d7/dd5/cob_8h_source.html">cob.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for m0_cob:</div>
<div class="dyncontent">
<div class="center"><img src="../../d6/d61/structm0__cob__coll__graph.png" border="0" usemap="#m0__cob_coll__map" alt="Collaboration graph"/></div>
<map name="m0__cob_coll__map" id="m0__cob_coll__map">
<area shape="rect" id="node2" href="../../d4/dba/structm0__cob__fabrec.html" title="{m0_cob_fabrec\n||}" alt="" coords="101,263,212,340"/>
<area shape="rect" id="node4" href="../../d1/d0a/structm0__stob.html" title="{m0_stob\n||}" alt="" coords="236,263,308,340"/>
<area shape="rect" id="node7" href="../../d5/df9/structm0__cob__nsrec.html" title="{m0_cob_nsrec\n||}" alt="" coords="332,263,439,340"/>
<area shape="rect" id="node5" href="../../d8/d89/structm0__file.html" title="{m0_file\n||}" alt="" coords="463,263,527,340"/>
<area shape="rect" id="node6" href="../../d5/d0f/structm0__cob__domain.html" title="{m0_cob_domain\n||}" alt="" coords="551,263,668,340"/>
<area shape="rect" id="node8" href="../../d7/d81/structm0__cob__omgrec.html" title="{m0_cob_omgrec\n||}" alt="" coords="693,263,812,340"/>
<area shape="rect" id="node9" href="../../dd/d3f/structm0__ref.html" title="{m0_ref\n||}" alt="" coords="836,263,898,340"/>
<area shape="rect" id="node10" href="../../da/db8/structm0__cob__nskey.html" title="{m0_cob_nskey\n||}" alt="" coords="922,263,1033,340"/>
<area shape="rect" id="node11" href="../../d9/dcb/structm0__cob__oikey.html" title="{m0_cob_oikey\n||}" alt="" coords="1058,263,1164,340"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:ga9efbd6de4f592963ffcd9375a98e5bee"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d5/d0f/structm0__cob__domain.html">m0_cob_domain</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/group__cob.html#ga9efbd6de4f592963ffcd9375a98e5bee">co_dom</a></td></tr>
<tr class="separator:ga9efbd6de4f592963ffcd9375a98e5bee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8cbfeb046f2f34b50819f1ea04ea6093"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d1/d0a/structm0__stob.html">m0_stob</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/group__cob.html#ga8cbfeb046f2f34b50819f1ea04ea6093">co_stob</a></td></tr>
<tr class="separator:ga8cbfeb046f2f34b50819f1ea04ea6093"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa8b201f3d914069b5b778f7f9246a652"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dd/d3f/structm0__ref.html">m0_ref</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/group__cob.html#gaa8b201f3d914069b5b778f7f9246a652">co_ref</a></td></tr>
<tr class="separator:gaa8b201f3d914069b5b778f7f9246a652"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad9d90ebae6ae4b5aa84a421f498275a6"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/group__cob.html#gad9d90ebae6ae4b5aa84a421f498275a6">co_flags</a></td></tr>
<tr class="separator:gad9d90ebae6ae4b5aa84a421f498275a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga86a208e597cc7f669517d2b3af6d85a3"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d8/d89/structm0__file.html">m0_file</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/group__cob.html#ga86a208e597cc7f669517d2b3af6d85a3">co_file</a></td></tr>
<tr class="separator:ga86a208e597cc7f669517d2b3af6d85a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga946daad0f89dc781c86c7f286258a989"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../da/db8/structm0__cob__nskey.html">m0_cob_nskey</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/group__cob.html#ga946daad0f89dc781c86c7f286258a989">co_nskey</a></td></tr>
<tr class="separator:ga946daad0f89dc781c86c7f286258a989"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafb56fae7f6bbcc246738b3c18d749294"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/dcb/structm0__cob__oikey.html">m0_cob_oikey</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/group__cob.html#gafb56fae7f6bbcc246738b3c18d749294">co_oikey</a></td></tr>
<tr class="separator:gafb56fae7f6bbcc246738b3c18d749294"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga185c07fa9d44d245fc4a71fc901bffd5"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d5/df9/structm0__cob__nsrec.html">m0_cob_nsrec</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/group__cob.html#ga185c07fa9d44d245fc4a71fc901bffd5">co_nsrec</a></td></tr>
<tr class="separator:ga185c07fa9d44d245fc4a71fc901bffd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga81e2ac2e455982cc7b0b3d67d9c8427c"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d4/dba/structm0__cob__fabrec.html">m0_cob_fabrec</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/group__cob.html#ga81e2ac2e455982cc7b0b3d67d9c8427c">co_fabrec</a></td></tr>
<tr class="separator:ga81e2ac2e455982cc7b0b3d67d9c8427c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga59085d49efc22c3313e645052c1efb19"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d7/d81/structm0__cob__omgrec.html">m0_cob_omgrec</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/group__cob.html#ga59085d49efc22c3313e645052c1efb19">co_omgrec</a></td></tr>
<tr class="separator:ga59085d49efc22c3313e645052c1efb19"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>In-memory representation of a component object.</p>
<p><a class="el" href="../../de/d54/structm0__cob.html">m0_cob</a> is an in-memory structure, populated from database tables on demand. <a class="el" href="../../de/d54/structm0__cob.html">m0_cob</a> is not cached for long time (except for root) and is only used as a temporary handle of database structures for the sake of handiness. This means, we don't need to bother with locking as every time we pass cob to some function this is new instance of it.</p>
<p>The exposed methods to get a new instance of cob are:</p><ul>
<li><a class="el" href="../../d3/d8e/group__cob.html#ga04c0791be14a28f022d884890eb3c5c0">m0_cob_lookup()</a> - allocate new in-memory cob and populate it with lookup by name.</li>
<li><a class="el" href="../../d3/d8e/group__cob.html#gac0403dde99c1bb3e817b017a137a1310">m0_cob_locate()</a> - allocate new in-memory cob and populate it with lookup by fid.</li>
<li><a class="el" href="../../d3/d8e/group__cob.html#ga7840e004a1c1b8431a212119e27b7bb5">m0_cob_create()</a> - allocate new in-memory cob, populate it with passed records and create database structures.</li>
</ul>
<p>The cobs returned by these methods are always populated.</p>
<p>Not populated cob is only exposed with <a class="el" href="../../d3/d8e/group__cob.html#ga47e20f53fd0d79ce9a28d3135f74b32f">m0_cob_alloc()</a> method, which is used by request handler and (possibly) others. Such a cob is used as an input parameter to functions mentioned above.</p>
<p>Users use m0_cob_get/put to hold/release references; a cob may be destroyed on the last put, or it may be cached for some time (just like root cob is). </p><dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000044">Todo:</a></b></dt><dd>at some point, we may replace the co_ref by taking a reference on the underlying co_stob. At that point, we will need a callback at last put. We wait to see how cob users will use these references, whether they need callbacks in turn, etc.</dd></dl>
<p>A <a class="el" href="../../de/d54/structm0__cob.html">m0_cob</a> serves several purposes:</p>
<ul>
<li>it acts as a handle for the underlying metadata storage. Meta-data operations can be executed on persistent storage by calling functions on <a class="el" href="../../de/d54/structm0__cob.html">m0_cob</a>;</li>
<li>it caches certain metadata attributes in memory (controlled by -&gt;co_flags);</li>
</ul>
<p><b>Liveness</b> A <a class="el" href="../../de/d54/structm0__cob.html">m0_cob</a> may be freed when the reference count drops to 0.</p>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="../../da/db8/structm0__cob__nskey.html">m0_cob_nskey</a> is allocated separately because it is variable length. Once allocated, it can be released if M0_CA_NSKEY_FREE flag is specified in its allocation time.</dd></dl>
<p><b>Caching and concurrency</b> Cobs are not cached by cob domain, neither by cob API users. Rationale is the following:</p>
<ul>
<li>we use db[45] for storing metadata and it already has cache that may work in a way that satisfies our needs;</li>
<li>using cache means substantial complications with locking and concurrent access. Currently these issues are completely covered by db[45]. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="../../d7/dd5/cob_8h_source.html#l00581">581</a> of file <a class="el" href="../../d7/dd5/cob_8h_source.html">cob.h</a>.</p>
</div><hr/>The documentation for this struct was generated from the following file:<ul>
<li>cob/<a class="el" href="../../d7/dd5/cob_8h_source.html">cob.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../de/d54/structm0__cob.html">m0_cob</a></li>
    <li class="footer">Generated on Fri May 20 2022 10:36:12 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
