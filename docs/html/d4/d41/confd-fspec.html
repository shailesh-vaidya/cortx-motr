<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: Configuration Service (confd)</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d4/d41/confd-fspec.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Configuration Service (confd) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>XXX FIXME: confd documentation is outdated.</p>
<p>Configuration service (confd) is designed to work as a part of user-space configuration service, driven by request handler and provides a "FOP-based" interface for accessing Motr configuration information stored in configuration db. Confd is run within the context of a request handler.</p>
<p>Confd pre-loads configuration values fetched from configuration db in memory-based data cache to speed up confc requests.</p>
<ul>
<li><a class="el" href="../../d4/d41/confd-fspec.html#confd-fspec-data">Data Structures</a></li>
<li><a class="el" href="../../d4/d41/confd-fspec.html#confd-fspec-sub">Subroutines</a><ul>
<li><a class="el" href="../../d4/d41/confd-fspec.html#confd-fspec-sub-setup">Initialization and termination</a></li>
</ul>
</li>
<li><a class="el" href="../../d4/d41/confd-fspec.html#confd-fspec-cli">Command Usage</a></li>
<li><a class="el" href="../../d4/d41/confd-fspec.html#confd-fspec-recipes">Recipes</a><ul>
<li><a class="el" href="../../d4/d41/confd-fspec.html#confd-fspec-recipe1">Typical interaction between confc and confd</a></li>
</ul>
</li>
<li><a class="el" href="../../df/d1e/group__confd__dfspec.html">Detailed Functional Specification</a></li>
</ul>
<hr/>
 <h1><a class="anchor" id="confd-fspec-data"></a>
Data Structures</h1>
<ul>
<li><a class="el" href="../../d2/dbd/structm0__confd.html">m0_confd</a> &mdash; represents configuration service instance registered in request handler, stores structures to perform caching, accesses to configuration db and handles configuration data requests.</li>
<li><p class="startli">m0_confd_cache &ndash; represents an efficient, high concurrency, in-memory cache over the underlying database.</p>
<p class="startli">Members:</p>
</li>
<li>m0_confd_cache::ca_db is a database environment to access configuration db.</li>
<li>m0_confd_cache::ca_cache is a registry of cached configuration objects.</li>
</ul>
<p>Confd receives multiple configuration requests from confcs. Each request is a FOP containing a "path" of a requested configuration value to be retrieved from the configuration db. Confcs and confds use RPC layer as a transport to send FOPs.</p>
<p>The following FOPs are defined for confd (see <a class="el" href="../../d6/dcb/conf_2onwire_8h.html">conf/onwire.h</a>):</p><ul>
<li><a class="el" href="../../df/d50/structm0__conf__fetch.html">m0_conf_fetch</a> &mdash; configuration request;</li>
<li><a class="el" href="../../de/d40/structm0__conf__fetch__resp.html">m0_conf_fetch_resp</a> &mdash; Confd's response to <a class="el" href="../../df/d50/structm0__conf__fetch.html">m0_conf_fetch</a>;</li>
<li><a class="el" href="../../d1/d24/structm0__conf__update.html">m0_conf_update</a> &mdash; Update request;</li>
<li><a class="el" href="../../d0/d23/structm0__conf__update__resp.html">m0_conf_update_resp</a> &mdash; Confd's response to <a class="el" href="../../d1/d24/structm0__conf__update.html">m0_conf_update</a>;</li>
</ul>
<hr/>
 <h1><a class="anchor" id="confd-fspec-sub"></a>
Subroutines</h1>
<ul>
<li><a class="el" href="../../df/d1e/group__confd__dfspec.html#ga06d5da2fc0ed814df3702fb3cbb13d96">m0_confd_register()</a> - registers confd service in the system.</li>
<li><a class="el" href="../../df/d1e/group__confd__dfspec.html#ga8fbf6d092080d9623f2511368f34554d">m0_confd_unregister()</a> - unregisters confd service.</li>
</ul>
<h2><a class="anchor" id="confd-fspec-sub-setup"></a>
Initialization and termination</h2>
<p>Confd is initiated and put into operation by request handler logic, after motr is started. Confd service should be registered in request handler with <a class="el" href="../../df/d1e/group__confd__dfspec.html#ga06d5da2fc0ed814df3702fb3cbb13d96">m0_confd_register()</a> call, where it has to initialise own data structures and FOPs used for communication.</p>
<p>Initial configuration database is manually created prior to startup. Confd assumes that:</p><ul>
<li>configuration db is created before confd started;</li>
<li>the schema of configuration database conforms to the expected schema.</li>
</ul>
<p>The following errors may occur while using the configuration db:</p><ul>
<li>db is empty or is in an unrecognized format;</li>
<li>db schema does not conform to HLD of Motrâ€™s configuration database schema : For documentation links, please refer to this file : doc/motr-design-doc-list.rst</li>
</ul>
<p>While initialization process, confd has to preload internal cache of configuration objects with their configuration values. It loads entire configuration db into memory-based structures. Pre-loading details can be found in <a class="el" href="../../d0/dcc/confd-lspec-page.html#confd-lspec">Logical Specification</a>.</p>
<p>Initialised confd may be eventually terminated by <a class="el" href="../../df/d1e/group__confd__dfspec.html#ga8fbf6d092080d9623f2511368f34554d">m0_confd_unregister()</a> in which confd has to finalise own data structures and FOPs.</p>
<p>After a confd instance is started it manages configuration database, its own internal cache structures and incoming FOP-requests.</p>
<h1><a class="anchor" id="confd-fspec-cli"></a>
Command Usage</h1>
<p>To configure confd from console, standard options described in <a class="el" href="../../df/dca/group__m0d.html">Motr Setup</a> in <a class="el" href="../../df/dca/group__m0d.html#gacdcd49ecdaa8c569d91132edc2af6712">cs_help()</a> function are used.</p>
<hr/>
 <h1><a class="anchor" id="confd-fspec-recipes"></a>
Recipes</h1>
<h2><a class="anchor" id="confd-fspec-recipe1"></a>
Typical interaction between confc and confd</h2>
<p>Client sends a <a class="el" href="../../df/d50/structm0__conf__fetch.html">m0_conf_fetch</a> FOP request to confd;</p>
<p>Configuration service processes confc requests in <a class="el" href="../../d6/dda/structm0__fom__ops.html#a43d7f67fb67810b227eab454513bec33">m0_fom_ops::fo_tick()</a> function of <a class="el" href="../../df/d50/structm0__conf__fetch.html">m0_conf_fetch</a> FOP request and sends <a class="el" href="../../de/d40/structm0__conf__fetch__resp.html">m0_conf_fetch_resp</a> FOP back.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../df/d1e/group__confd__dfspec.html" title="Detailed Functional Specification. ">Configuration Service (confd)</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d3/dd6/_d_l_d_i_x.html">Detailed Designs</a></li><li class="navelem"><a class="el" href="../../d2/dd9/conf.html">DLD of configuration caching</a></li>
    <li class="footer">Generated on Fri May 20 2022 10:35:29 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
