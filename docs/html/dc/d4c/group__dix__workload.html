<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: Workload module for client DIX</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dc/d4c/group__dix__workload.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Workload module for client DIX<div class="ingroups"><a class="el" href="../../d8/d42/group__crate.html">Crate</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Workload module for client DIX:</div>
<div class="dyncontent">
<center><table><tr><td><img src="../../dc/d4c/group__dix__workload.png" border="0" alt="" usemap="#dc_2d4c_2group____dix____workload"/>
<map name="dc_2d4c_2group____dix____workload" id="dc_2d4c_2group____dix____workload">
<area shape="rect" id="node2" href="../../d8/d42/group__crate.html" title="Crate" alt="" coords="5,13,60,39"/>
</map>
</td></tr></table></center>
</div>
<h2>Crate index workload overview. </h2>
<p>Crate execution for index measurements consists of two parts:</p><ol type="1">
<li>Warmup.</li>
<li>Common operations.</li>
</ol>
<p>Warmup is supposed to prepare index to workload. For example, if we have to measure over fragmented index, we should setup next parameters: </p><div class="fragment"><div class="line">NUM_KVP: 8</div><div class="line">WARMUP_PUT_CNT: 1024</div><div class="line">WARMUP_DEL_RATIO: 2</div></div><!-- fragment --><p> It is means, that crate performs next operations: </p><div class="fragment"><div class="line">1024 <a class="code" href="../../d4/d44/group__cas.html#ggae5a29d52512d021ae3d2fdbb2de3dc55afec39d40e8bc9e12afa614df5ddb9fa9">PUT</a> <a class="code" href="../../d0/d5d/ut_2sm_8c.html#a946a8f8377210c472c7cbdf11f154280">x</a> 8 kv/<a class="code" href="../../d3/d1b/libdemo_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a> (sequentially)</div><div class="line">1024/2 <a class="code" href="../../d4/d44/group__cas.html#ggae5a29d52512d021ae3d2fdbb2de3dc55a11563127ec3be864b514a1784c5d37a6">DEL</a> <a class="code" href="../../d0/d5d/ut_2sm_8c.html#a946a8f8377210c472c7cbdf11f154280">x</a> 8 kv/<a class="code" href="../../d3/d1b/libdemo_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a> (randomly)</div></div><!-- fragment --><p>Common operations are executed randomly (see <a class="el" href="../../de/d09/crate__index_8c.html#a988c09d34d5bfc54b0458b32b6aad874">cr_op_selector</a>). Each operaion has 'percents' of total operations count (OP_COUNT). Total number of keys in use are calculated by OP_COUNT and NUM_KVP. OP_COUNT can be "unlimited" <em>TODO: for now, it means <code>INT_MAX / (128 * NUM_KVP)</code> operations</em>.</p>
<h2>Crate index workload detailed description. </h2>
<h2>Workload has following parameters:</h2>
<ul>
<li>WORKLOAD_TYPE - always 0 (idx operations).</li>
<li>WORKLOAD_SEED - initial value for pseudo-random generator (int or "tstamp").</li>
<li>KEY_SIZE - size of the key; can be defined as number or "random", KEY_SIZE should be &gt;= 16</li>
<li>VALUE_SIZE - size of the value; can be defined as number or "random"</li>
<li>MAX_KEY_SIZE - max size of key; used in case, when KEY_SIZE = "random". Also, see <a class="el" href="../../de/d09/crate__index_8c.html#a640e110a8e92c1283f2aae76e4649f48a28f7015df65dfc71cae1d5fb1e58a62d">CR_MAX_OF_MAX_KEY_SIZE</a>.</li>
<li>MAX_VALUE_SIZE - max size of value; used in case, when VALUE_SIZE = "random". Also, see <a class="el" href="../../de/d09/crate__index_8c.html#a640e110a8e92c1283f2aae76e4649f48a9acdb12d569755da2a517f13ed64f216">CR_MAX_OF_MAX_VALUE_SIZE</a>.</li>
<li>OP_COUNT - total operations count; can be defined as number, number with units (1K), or "unlimited".</li>
<li>PUT,GET,DEL,NEXT - percents of portion operations.</li>
<li>EXEC_TIME - time limit for executing; can be defined as number (seconds), or "unlimited".</li>
<li>NUM_KVP - number of records, which should be processed at operation.</li>
<li>NXRECORDS - number of records, which should be processed at NEXT operation; can be defined as number, number with units (1K) or "default" (NXRECORDS == NUM_KVP).</li>
<li>KEY_PREFIX - number, which suppose to define the key space (fid.f_container); can be defined as a number or "random".</li>
<li>WARMUP_PUT_CNT - count of PUT operations in "warmup" step; defined as number of operations or as "all" (it means "fill all keys in
     the index").</li>
<li>WARMUP_DEL_RATIO - ratio, which determines, which portion of WARMUP_PUT_CNT should deleted in random order (int).</li>
<li>KEY_ORDER - defines key ordering in operations ("ordered" or "random").</li>
<li>INDEX_FID - index fid (fid, for example, <code>&lt;7800000000000001:0&gt;</code>).</li>
<li>LOG_LEVEL - logging level(err(0), warn(1), info(2), trace(3), debug(4)).</li>
</ul>
<h2>Operation order (see <a class="el" href="../../de/d09/crate__index_8c.html#a2268f0df46d9e28f5b5953a89c5b27b7">cr_idx_w_select_op</a>)</h2>
<p>Operations are executed in round-robin manner or randomly. If crate can't find appropriate keys for operation then it marks operation as "pending". Selector knows about it and can unmark pending ops, if it cannot find appropriate operations.</p>
<h2>Keys order</h2>
<p>Keys can be generated sequentially or randomly. There are two functions: <code>cr_idx_w_find_rnd_k</code> and <code>cr_idx_w_find_seq_k</code>. They both have the same signature, but different logic.</p>
<h3><a class="el" href="../../de/d09/crate__index_8c.html#a224a72660c52d72e4c4d3853deabdca1">cr_idx_w_find_seq_k</a></h3>
<p>This function selects next keys from starting key to <code>nr_keys</code> (the end of keys space). Starting key value depends on operation type: readonly operations (GET,NEXT) should store last key from previous key sequence; other operations (PUT,DEL) starts from first key. Anyway, they iterate over all available keys and fill key list.</p>
<h3><a class="el" href="../../de/d09/crate__index_8c.html#affa442c97b4effc0152a5c3e3aa4bb80">cr_idx_w_find_rnd_k</a></h3>
<p>This function selects random key, puts it in the key list and does it again until list is full or bitmap is full.</p>
<h2>Different logic for different operations (see struct <a class="el" href="../../dd/deb/structcr__idx__w__ops.html">cr_idx_w_ops</a>).</h2>
<p>This struct describes how operation should be prepared for execution and how they change storage state.</p>
<h2>Measurements</h2>
<p>Currently, only execution time is measured during the test. It measures with <code>m0_time*</code> functions. Crate prints result to stdout when test is finished.</p>
<h2>Logging</h2>
<p>crate has own logging system, which based on <code>fprintf(stderr...)</code>. (see <a class="el" href="../../d8/def/group__crate__logger.html#gae596d676f312bf892cbfdc3c68b77e5c">crlog</a> and see <a class="el" href="../../d8/def/group__crate__logger.html#ga55e7e56867abfd98d4d3e7b223f875b1">cr_log</a>).</p>
<h2>Execution time limits</h2>
<p>There are two ways to limit execution time. The first, is operations time limit, which checks after operation executed (as described in HLD). The second way uses the watchdog, which detects staled client operations. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 20 2022 10:35:56 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
