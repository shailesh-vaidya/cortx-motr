<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: DLD of Layout Generation from Configuration</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dc/d59/_d_l_d-layout-from-conf-schema.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">DLD of Layout Generation from Configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="../../dc/d59/_d_l_d-layout-from-conf-schema.html#DLD-layout-from-conf-schema-ovw">Overview</a></li>
<li><a class="el" href="../../dc/d59/_d_l_d-layout-from-conf-schema.html#DLD-layout-from-conf-schema-highlights">Design Highlights</a></li>
<li><a class="el" href="../../dc/d59/_d_l_d-layout-from-conf-schema.html#DLD-layout-from-conf-schema-def">Definitions</a></li>
<li><a class="el" href="../../dc/d59/_d_l_d-layout-from-conf-schema.html#DLD-layout-from-conf-schema-req">Requirements</a></li>
<li><a class="el" href="../../dc/d59/_d_l_d-layout-from-conf-schema.html#DLD-layout-from-conf_schema-depends">Dependencies</a></li>
<li><a class="el" href="../../dc/d59/_d_l_d-layout-from-conf-schema.html#DLD-layout-from-conf-schema-fspecs">Functional Specifications</a></li>
<li><a class="el" href="../../dc/d59/_d_l_d-layout-from-conf-schema.html#DLD-layout-from-conf-schema-lspec">Logical Specifications</a></li>
<li><a class="el" href="../../dc/d59/_d_l_d-layout-from-conf-schema.html#DLD-layout-from-conf-schema-st">System Tests</a></li>
</ul>
<hr/>
 <h1><a class="anchor" id="DLD-layout-from-conf-schema-ovw"></a>
Overview</h1>
<p>For the sake of reference, this work is based on MOTR-463 and uses some of its APIs and infrastructure.</p>
<p>The idea of this work is to generate layouts out of filesystem configuration instead of hardcoding in a way its done these days. Layout generation should be performed independently on both server and client sides. Given layout has the same id on client and server, same layout can be used by both sides. This can be done in reqh init time, when pools and pool versions are initialized.</p>
<hr/>
 <h1><a class="anchor" id="DLD-layout-from-conf-schema-def"></a>
Definitions</h1>
<p><b>Pool</b> is a set of hardware resources. <b>Pool</b> Version Change set for pool. <b>Layout</b> Binary version of pool version ready for use.</p>
<hr/>
 <h1><a class="anchor" id="DLD-layout-from-conf-schema-highlights"></a>
Design Highlights</h1>
<p>Given pool versions are related to layouts they describe, it makes sense to generate layouts in same code path when corresponding pool version is ready and populated. As per now, this can be done in m0t1fs_pool_find() when new pool version is initialized by <a class="el" href="../../dd/d7f/group__pool.html#ga0e3e0f4951cd2aacbe976207d1038140">m0_pool_version_init_by_conf()</a>, which is done on-demand. After more discussions it was decided that all the pools, their versions along with the layouts should be populated on bootstrap on client and server. On client this can be done in mount code path and on server - on layout domain init code path. Given all said above, current on-demand code in MOTR-463 should be re-worked to do all things in one place.</p>
<p>When this is done, server and client will have own lists of layouts available and can access them using layout id communicated between server and client.</p>
<hr/>
 <h1><a class="anchor" id="DLD-layout-from-conf-schema-req"></a>
Requirements</h1>
<p><b>r.layout.conf</b> All the pool versions available in configuration should be populated as a precondition on client and server <b>r.layout.conf.all_versions</b> All the avaialble layouts should be generated by implementation, not only one currently in use <b>r.layout.conf.interface</b> Interface for accessing generated layouts should be provided by the implementation <b>r.layout.conf.startup</b> Generation of layouts should be done on startup</p>
<hr/>
 <h1><a class="anchor" id="DLD-layout-from-conf_schema-depends"></a>
Dependencies</h1>
<p>MOTR-463 API and infrastructure should be available before coding can be started.</p>
<hr/>
 <h1><a class="anchor" id="DLD-layout-from-conf-schema-fspecs"></a>
Functional Specifications</h1>
<h2><a class="anchor" id="DLD-layout-from-conf-schema-fspecs-data"></a>
Data Structures</h2>
<p>generated-layout-list Defined as The List of generated layouts</p>
<p><a class="el" href="../../dd/d2e/group__m0__long__lock___a_p_i.html#gab149301f172d3311436bdb6951300f7d">generated-layout-list::lock</a> Defined as The Lock protecting the list of generated layouts</p>
<h2><a class="anchor" id="DLD-layout-from-conf-schema-fspecs-if"></a>
Interfaces</h2>
<ul>
<li>m0_layout_init_by_pver</li>
</ul>
<hr/>
 <h1><a class="anchor" id="DLD-layout-from-conf-schema-lspec"></a>
Logical Specifications</h1>
<h2><a class="anchor" id="DLD-layout-from-conf-schema-lspec-layout-init-by-pver"></a>
Generate</h2>
<p>Layouts. Provides interface to generate layout from pver.</p>
<hr/>
 <h1><a class="anchor" id="DLD-layout-from-conf-schema-st"></a>
System Tests</h1>
<p>All tests are covered by existing system tests. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 20 2022 10:35:33 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
