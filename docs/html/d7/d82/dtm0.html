<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: log implementation</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d7/d82/dtm0.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">log implementation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p>DTM0 log module will be working on incoming message request, the goal of this module is to track journaling of incoming message either on persistent or volatile memory based on whether logging is happening on participant or on originator, so that in the phase failure consistency of failed participant can be restored by iterating over logged journal(DTM0 log record) to decide which of the logged record needs to be sent as a redo request.</p>
<p>A distributed transaction(dtx) has a group of states of each individual participant of the distributed transaction(dtx) (note: originator is not a part of this group). Each entry of such a group may have many different states, but this set of states must include the following states:</p>
<p>1) InProgress - the node (owner of the log) has a request. 2) Executed - one or more operations have been executed in volatile memory of the participant, the result of such execution is known and returned to the dtx user. 3) Persistent - locally persisted in transactional context. 4) Stable - sufficient number of sent operations have been “persisted” on the remote end which guarantees survivial of persistent failures. 5) DONE - all sent operations have been “persisted” on sufficient number of non-failed participants.</p>
<p>Every participant maintains the journal <a class="el" href="../../d1/d49/structrecord.html">record(DTM0 Log record)</a> that corresponds to each distributed transaction(dtx) and it can be described by "struct m0_dtm0_log_rec" which will be stored in volatile/persistent storage. Basically this log record will maintain txr id, group of state of each individual participant and payload.</p>
<p>When a distributed transaction(dtx) is executed by participant, participant modifies its state in group of state as M0_DTPS_EXECUTED and will add/modify DTM0 log record, for rest of the participant it will keep the state as it is in distributed transaction(dtx).</p>
<p>When a distributed transaction(dtx) becomes persistent on participant, participant will modify its state in group of state as M0_DTPS_PERSISTENT and will modify DTM0 log record. For rest of the participants it will keep the state as it is in DTM0 log record.</p>
<p>Originator also maintains the same distributed transaction(dtx) record in volatile memory. Originator is expecting to get replies from participant when distributed transaction(dtx) on participant is M0_DTPS_EXECUTED or M0_DTPS_PERSISTENT. On originator the state of the distributed transaction (dtx) can be M0_DTPS_INPROGRESS to M0_DTPS_PERSISTENT for each participant.</p>
<p>During recovery operation of any of the participant, rest of the participant and originator will iterate over the logged journal and extract the state of each transation for participant under recovery from logged information and will send redo request for those distributed transaction(dtx) which are not M0_DTPS_PERSISTENT on participant being recovered.</p>
<p>Upon receiving redo request participant under recovery will log the state of same distributed transaction(dtx) of remote participant in persistent store.</p>
<h1><a class="anchor" id="Usecases"></a>
Usecases</h1>
<ol type="1">
<li>There is a dedicated function m0_be_dtm0_log_create which will create <a class="el" href="../../df/dea/structm0__be__dtm0__log.html">m0_be_dtm0_log</a> during mkfs procedure.</li>
<li>When a distributed transaction(dtx) is successfully executed on a participant, the participant will add a new log record to DTM0 log. The state of the participant will be set to M0_DTPS_EXECUTED in the record. The states of the other participants will be set to M0_DTPS_INPROGRESS in the record.</li>
<li>When a distributed transaction(dtx) becomes persistent on a particular participant, the state of the distributed transaction(dtx) for this participant will be updated to M0_DTPS_PERSISTENT.</li>
<li><p class="startli">When distributed transaction(dtx) becomes persistent on a participant, this participant sends a persistent notice to rest of the participants and to the originator indicating that the given distributed transaction(dtx) is now persistent on its store. Upon receiving a persistent notice, the recipient will update the state of the distributed transaction(dtx) for the sender as M0_DTPS_PERSISTENT in its own DTM0 log.</p>
<p class="startli">There is one special case where a participant gets a persistent notice from another participant but the corresponding request and reply haven't been received/processed yet. In this case, the DTM service should add a special log record: a log record with empty payload (NULL). The users of DTM0 log should be ready to encounter such a log entry, and handle it appropriately. </p>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 20 2022 10:35:29 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
