<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: DLD Device command</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d8/d93/_d_l_d_sss_device.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">DLD Device command </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="../../d8/d93/_d_l_d_sss_device.html#DLD-sss_device-ds">Data Structures</a></li>
<li><a class="el" href="../../d8/d93/_d_l_d_sss_device.html#DLD-sss_device-usecases">Unit tests</a></li>
<li><a class="el" href="../../d8/d65/group___d_l_d_g_r_p__sss__device.html">Device command internal</a></li>
</ul>
<p>Device commands derived disk (see <a class="el" href="../../d0/d20/structm0__conf__drive.html">m0_conf_drive</a>) on Motr. Each device must preregister on Pool machine, and has record in confc subsystem. All additional information about disk and its storage device must present in confc on server side.</p>
<p>Server side - all know Motr instances with ioservices service.</p>
<p>Commands</p>
<p>Attach device - create AD stob domain and backing store stob. Also create and run Pool event for set status "Device online" in Pool machine. Its mechanism like create each disk duration start Motr instance.</p>
<p>Detach device - finalize AD stob domain and backing store stob in memory. Its not destroy file on storage device - remove information about storage device file for Motr only. Also create and run Pool event for set status "Device offline".</p>
<p>Format device - formatting storage device. Not implement on server side.</p>
<h1><a class="anchor" id="DLD-sss_device-ds"></a>
Data Structures</h1>
<p>Device command interface data structures include fop <a class="el" href="../../d9/d3d/structm0__sss__device__fop.html">m0_sss_device_fop</a>, command enumerated m0_sss_device_req_cmd.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="../../d5/d01/structm0__fop.html">m0_fop</a>  *<a class="code" href="../../d9/dbf/ut_2item_8c.html#aa6954df11aaf0bcf90cf350315b8c544">fop</a>;</div><div class="line"></div><div class="line"><a class="code" href="../../d9/dbf/ut_2item_8c.html#aa6954df11aaf0bcf90cf350315b8c544">fop</a>  = <a class="code" href="../../d8/d65/group___d_l_d_g_r_p__sss__device.html#ga893805e648e4072126d89060e979c7cd">m0_sss_device_fop_create</a>(<a class="code" href="../../d6/d63/ut_2formation2_8c.html#a0b08db906b7ce4b2e2ae846e56645294">rmachine</a>, cmd, dev_fid);</div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="../../d9/dbf/ut_2item_8c.html#aa6954df11aaf0bcf90cf350315b8c544">fop</a> == <a class="code" href="../../db/df8/lib_2user__space_2misc_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#a9a02a790ad457506f9f3bc12121e6079">M0_RC</a>(-ENOMEM);</div></div><!-- fragment --><p>cmd - device command id - see m0_sss_device_req_cmd dev_fid - Disk FID.</p>
<p>Reply fop - <a class="el" href="../../d8/d57/structm0__sss__device__fop__rep.html">m0_sss_device_fop_rep</a> contain error status of command.</p>
<h1><a class="anchor" id="DLD-sss_device-usecases"></a>
Unit tests</h1>
<p>spiel-ci-ut:device-cmds</p>
<p>Contain 4 steps:</p>
<ul>
<li>detach - detach device. Device was connect on standard start UT and description in file ut/conf.xc. Expected return value - OK (0)</li>
<li>attach - attach device. Attach device which was detach on previous step. Expected return value - OK (0)</li>
<li>format - format device. Client send command and receive answer. No activity on server side except receive command and send answer. Expected return value - OK (0)</li>
<li>detach with invalid fid - detach device with invalid fid. Command not send. Expected return value - (-ENOENT)</li>
</ul>
<p>sss-ut:device-fom-fail</p>
<p>Test some error when create fom for this commands. See create command m0_sss_device_fop_create and custom fom struct m0_sss_device_fom. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 20 2022 10:35:35 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
