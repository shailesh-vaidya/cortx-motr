<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: m0t1fs</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('da/d0f/group__m0t1fs.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a>  </div>
  <div class="headertitle">
<div class="title">m0t1fs</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga2215bf270a4991ca057bb6efb294846b"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <br />
&#160;&#160;<a class="el" href="../../da/d0f/group__m0t1fs.html#gga2215bf270a4991ca057bb6efb294846ba88127a81ca6c8b9d40b1a461d6483fa3">M0_AVI_FS_OPEN</a> = M0_AVI_M0T1FS_RANGE_START + 1, 
<a class="el" href="../../da/d0f/group__m0t1fs.html#gga2215bf270a4991ca057bb6efb294846ba3b928da48f15485ac995673fe42c6326">M0_AVI_FS_LOOKUP</a>, 
<a class="el" href="../../da/d0f/group__m0t1fs.html#gga2215bf270a4991ca057bb6efb294846baecc190f3ac7f32709071b20940322fba">M0_AVI_FS_CREATE</a>, 
<a class="el" href="../../da/d0f/group__m0t1fs.html#gga2215bf270a4991ca057bb6efb294846baba8053fbbf07a8b25546792735c30740">M0_AVI_FS_READ</a>, 
<br />
&#160;&#160;<a class="el" href="../../da/d0f/group__m0t1fs.html#gga2215bf270a4991ca057bb6efb294846bab10bfae89fb00fec9dd3874293162d1d">M0_AVI_FS_WRITE</a>, 
<a class="el" href="../../da/d0f/group__m0t1fs.html#gga2215bf270a4991ca057bb6efb294846baad9ced82f90c98245a020dbb7bb7b470">M0_AVI_FS_IO_DESCR</a>, 
<a class="el" href="../../da/d0f/group__m0t1fs.html#gga2215bf270a4991ca057bb6efb294846ba2e5fa0cb0af008472d35c4be1564b3a7">M0_AVI_FS_IO_MAP</a>
<br />
 }</td></tr>
<tr class="separator:ga2215bf270a4991ca057bb6efb294846b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p>m0t1fs is a motr client file-system for linux. It is implemented as a kernel module.</p>
<h1><a class="anchor" id="m0t1fsfuncspec"></a>
Function Specification</h1>
<p>m0t1fs has flat file-system structure i.e. no directories except root. m0t1fs does not support caching. All read-write requests are directly forwarded to servers.</p>
<p>By default m0t1fs uses end-point address 0:12345:45:6 as its local address. This address can be changed with local_addr module parameter. e.g. to make m0t1fs use 172.18.50.40:12345:34:1 as its end-point address load module with command:</p>
<p>sudo insmod m0tr.ko local_addr="172.18.50.40@o2ib1:12345:34:1"</p>
<p>m0t1fs can be mounted with mount command:</p>
<p>mount -t m0t1fs -o &lt;options_list&gt; dontcare &lt;dir_name&gt;</p>
<p>where &lt;options_list&gt; is a comma separated list of option=value elements. Currently supported list of options is:</p>
<ul>
<li>confd [value type: end-point address, e.g. 192.168.50.40:12345:34:1] end-point address of confd service.</li>
<li>profile [value type: string] configuration profile used while fetching configuration data from confd.</li>
<li><p class="startli">fid_start [value type: uint32_t, default: 4] TEMPORARY option. Client allocates fid for a file during its creation. It assigns &lt;0, $fid_start&gt; for first file, &lt;0, $fid_start+1&gt; for second and so on. mdstore uses constant fid - M0_MDSERVICE_SLASH_FID &lt;1, 65535&gt; for namespace root exposed to user.</p>
<p class="startli">Fids below 65535 are reserved for special objects such as: storage root, ".motr", ".motr/fid" and potentially many others that will live in ".motr" directory.</p>
<p class="startli">Hence fid_start must be greater than 65535.</p>
<p class="startli">'device' argument of mount command is ignored.</p>
<p class="startli">m0t1fs supports following operations:</p><ul>
<li>Creating a regular file</li>
<li>Remove a regular file</li>
<li>Listing files in root directory</li>
<li>file read/write of full-stripe width</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="m0t1fslogspec"></a>
Logical Specification</h1>
<p><b>mount/unmount:</b></p>
<p>m0t1fs establishes rpc-connections and rpc-sessions with all the services obtained from configuration data. If multiple services have same end-point address, separate rpc-connection is established with each service i.e. if N services have same end-point address, there will be N rpc-connections leading to same target end-point.</p>
<p>The rpc-connections and rpc-sessions will be terminated at unmount time.</p>
<p><b> Pools and Pool versions: </b></p>
<p>m0t1fs can work with multiple pools and pool versions. A pool version comprises of a set of services and devices attached to them. Layout and pool machine are associated with the pool version. Pool version creates a device to io service map during initialisation.</p>
<p>m0t1fs finds a valid pool and pool version to start with which has no devices from the failure set during mount. Once pool version is obtained, if its corresponding pool already exist them the pool version is added to it else new pool is initialised.</p>
<p><b> Containers and component objects: </b></p>
<p>An io service provides access to storage objects, md service provides access to md objects and rm service provides access to resources. Containers are used to migrate and locate object. Each container is identified by container-id. Storage objects and md objects are identified by fid which is a pair &lt;container-id, key&gt;. All objects belonging to same container have same value for fid.container_id which is equal to id of that container.</p>
<p>"Container location map" maps container-id to service.</p>
<p>Even if containers are not yet implemented, notion of container id is required, to be able to locate a service serving some object identified by fid.</p>
<p>Currently m0t1fs implements simple (and temporary) mechanism to build container location map. Number of containers is equal to P + 2, where P is pool width and additional 2 containers are used by meta-data and resource management. Pool width is a file-system parameter, obtained from configuration.</p>
<p>Assume a user-visible file F. A gob representing F is assigned fid &lt;0, K&gt;, where K is taken from a monotonically increasing counter (m0t1fs_sb::csb_next_key). Container-id 0 is mapped to md-service, by container location map. Container-id &lsquo;P+2&rsquo; is mapped to rm-service.</p>
<p>There are P number of component objects of file F, having fids { &lt;i, K&gt; | i = 1, 2..., P}. Here P is equal to pool_width mount option. Mapping from &lt;gob_fid, cob_index&gt; -&gt; cob_fid is implemented using linear enumeration (B * x + A) with both A and B parameters set to 1. Container location map, maps container-ids from 1 to P, to io-services.</p>
<p>Container location map is populated at mount time and is a part of a pool version.</p>
<p><b> Directory Operations: </b></p>
<p>To create a regular file, m0t1fs sends cob create requests to mds (for global object aka gob) and io-service (for component objects). Because, mds is not yet implemented, m0t1fs does not send cob create request to any mds. Instead all directory entries are maintained in an in-memory list in root inode itself.</p>
<p>If component object creation fails, m0t1fs does not attempt to cleanup component objects that were successfully created. This should be handled by dtm component, which is not yet implemented.</p>
<p><b> Read/Write: </b></p>
<p>m0t1fs currently supports only full stripe IO i.e. (iosize % (nr_data_units * stripe_unit_size) == 0)</p>
<p>read-write operations on file are not synchronised.</p>
<p>m0t1fs does not cache any data.</p>
<p>For simplicity, m0t1fs does synchronous rpc with io-services, to read/write component objects. </p>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ga2215bf270a4991ca057bb6efb294846b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2215bf270a4991ca057bb6efb294846b">&#9670;&nbsp;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="gga2215bf270a4991ca057bb6efb294846ba88127a81ca6c8b9d40b1a461d6483fa3"></a>M0_AVI_FS_OPEN&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="gga2215bf270a4991ca057bb6efb294846ba3b928da48f15485ac995673fe42c6326"></a>M0_AVI_FS_LOOKUP&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="gga2215bf270a4991ca057bb6efb294846baecc190f3ac7f32709071b20940322fba"></a>M0_AVI_FS_CREATE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="gga2215bf270a4991ca057bb6efb294846baba8053fbbf07a8b25546792735c30740"></a>M0_AVI_FS_READ&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="gga2215bf270a4991ca057bb6efb294846bab10bfae89fb00fec9dd3874293162d1d"></a>M0_AVI_FS_WRITE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="gga2215bf270a4991ca057bb6efb294846baad9ced82f90c98245a020dbb7bb7b470"></a>M0_AVI_FS_IO_DESCR&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="gga2215bf270a4991ca057bb6efb294846ba2e5fa0cb0af008472d35c4be1564b3a7"></a>M0_AVI_FS_IO_MAP&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="../../d9/d80/m0t1fs__addb2_8h_source.html#l00036">36</a> of file <a class="el" href="../../d9/d80/m0t1fs__addb2_8h_source.html">m0t1fs_addb2.h</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Apr 14 2022 14:03:46 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
