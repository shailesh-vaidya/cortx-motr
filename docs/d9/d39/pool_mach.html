<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: DLD of Pool Machine</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d9/d39/pool_mach.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">DLD of Pool Machine </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-ovw">Overview</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-def">Definitions</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-req">Requirements</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-depends">Dependencies</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-fspec">Functional Specification</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-lspec">Logical Specification</a><ul>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-lspec-comps">Component Overview</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-lspec-ds">Data Structures</a></li>
</ul>
</li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-conformance">Conformance</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-ut">Unit Tests</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-st">System Tests</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-O">Analysis</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-ref">References</a></li>
</ul>
<hr/>
 <h1><a class="anchor" id="pool_mach-ovw"></a>
Overview</h1>
<p>When system initializes the first time, pool machine state is configured from confc &amp; confd. When system restarts, ioservice/clients rebuld pool machine state on HA system events for respective pool devices.</p>
<p>Every pool version has its own pool machine state stored in memory and it rebuild using HA system events for respective pool devices on node restarts They are independent. Pool machine state transitions are triggered by pool machine events. Pool machine events, e.g. device failure event, SNS completion event, are delivered to all ioservices. So, these pool machine states are updated and the final pool machine states are identical on all nodes.</p>
<hr/>
 <h1><a class="anchor" id="pool_mach-def"></a>
Definitions</h1>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d8/dec/group__poolmach.html">Pool machine</a> for failure vectors, events, etc.</dd></dl>
<hr/>
 <h1><a class="anchor" id="pool_mach-req"></a>
Requirements</h1>
<p>The following requirements should be meet:</p><ul>
<li><b>R.DLD.P</b> All pool machine states should be rebuild using HA events. When system restarts again, these states are rebuilt from HA events for pool devices. <hr/>
 </li>
</ul>
<h1><a class="anchor" id="pool_mach-depends"></a>
Dependencies</h1>
<p>FOP. DTM. Pool. Pool Machine.</p>
<hr/>
 <h1><a class="anchor" id="pool_mach-fspec"></a>
Functional Specification</h1>
<p>Pool Machine states, including failure vectors, event lists, spare slots usages, etc. are stored in memory and get rebuild using HA events for pool devices on node restarts.</p>
<p>Every pool version has a pool machine. Pool machine update events are delivered to all ioservices. So all the pool machine there get state transitions according to these events.</p>
<p>HA component broadcasts every event to all the pool machines in the cluster using ha note interface. HA components can also use m0poolmach utility to query the current status of pool machine.</p>
<p>HA component or Administrator may trigger SNS repair and/or SNS rebalance operation using m0repair utility. HA component or Administrator decide when to trigger these operations upon various conditions, like failure type, the elapsed time from failure detected, etc.</p>
<hr/>
 <h1><a class="anchor" id="pool_mach-lspec"></a>
Logical Specification</h1>
<ul>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-lspec-comps">Component Overview</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-lspec-ds">Data Structures</a></li>
<li><a class="el" href="../../d9/d39/pool_mach.html#pool_mach-lspec-if">Interfaces</a></li>
</ul>
<h2><a class="anchor" id="pool_mach-lspec-comps"></a>
Component Overview</h2>
<p>Pool machine global information, like number of devices and number of nodes in this pool, current read and write version numbers are stored in in-memory data structures.</p>
<p>Every pool machine contains an array of struct <a class="el" href="../../d9/d78/structm0__pooldev.html">m0_pooldev</a>. Every instance of struct <a class="el" href="../../d9/d78/structm0__pooldev.html">m0_pooldev</a> represents a device in the pool and maintains the corresponding device state. This device informatin is refreshed on configuration updates. Similarly, the node in the pool is represented by struct <a class="el" href="../../d4/dff/structm0__poolnode.html">m0_poolnode</a>. This is also refreshed on configuration update.</p>
<h2><a class="anchor" id="pool_mach-lspec-ds"></a>
Data Structures</h2>
<p>The data structures of failure vector, failure vector version number, event, event list are in <a class="el" href="../../d8/dec/group__poolmach.html">Pool machine</a> module.</p>
<p>The pool state, state of node, state of device, events are defined in code.</p>
<h2><a class="anchor" id="pool_mach-lspec-if"></a>
Interfaces</h2>
<p>The failure vector and version number operations are designed and listed in <a class="el" href="../../d8/dec/group__poolmach.html">Pool machine</a>.</p>
<hr/>
 <h1><a class="anchor" id="pool_mach-conformance"></a>
Conformance</h1>
<ul>
<li><b>I.DLD.P</b> All pool machine states are rebuild using HA event for pool devices on node restarts.</li>
</ul>
<hr/>
 <h1><a class="anchor" id="pool_mach-ut"></a>
Unit Tests</h1>
<p>Unit test will cover the following case:</p><ul>
<li>init BE storage.</li>
<li>updates to BE.</li>
<li>load from BE.</li>
<li>Sending updates to replicas.</li>
<li>Replicas handles updates from peer.</li>
</ul>
<hr/>
 <h1><a class="anchor" id="pool_mach-st"></a>
System Tests</h1>
<p>Pool machine and its replicas works well when new pool machine events happen. Pool machine works well when system re-starts.</p>
<hr/>
 <h1><a class="anchor" id="pool_mach-O"></a>
Analysis</h1>
<p>N/A</p>
<hr/>
 <h1><a class="anchor" id="pool_mach-ref"></a>
References</h1>
<ul>
<li><a class="el" href="../../dir_d7b5bb5cd8e90d41c790b682ecdfe718.html">cm</a></li>
<li>agents</li>
<li><a class="el" href="../../d8/dec/group__poolmach.html">Pool machine</a></li>
<li>DB </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Apr 14 2022 14:03:27 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
