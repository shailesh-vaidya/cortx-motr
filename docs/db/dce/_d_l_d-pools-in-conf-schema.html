<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: DLD of Pools in Configuration Schema</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('db/dce/_d_l_d-pools-in-conf-schema.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">DLD of Pools in Configuration Schema </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="../../db/dce/_d_l_d-pools-in-conf-schema.html#DLD-pools-in-conf-schema-ovw">Overview</a></li>
<li><a class="el" href="../../db/dce/_d_l_d-pools-in-conf-schema.html#DLD-pools-in-conf-schema-highlights">Design Highlights</a></li>
<li><a class="el" href="../../db/dce/_d_l_d-pools-in-conf-schema.html#DLD-pools-in-conf-schema-def">Definitions</a></li>
<li><a class="el" href="../../db/dce/_d_l_d-pools-in-conf-schema.html#DLD-pools-in-conf-schema-req">Requirements</a></li>
<li><a class="el" href="../../db/dce/_d_l_d-pools-in-conf-schema.html#DLD-pools-in-conf_schema-depends">Dependencies</a></li>
<li><a class="el" href="../../db/dce/_d_l_d-pools-in-conf-schema.html#DLD-pools-in-conf-schema-fspecs">Functional Specifications</a></li>
<li><a class="el" href="../../db/dce/_d_l_d-pools-in-conf-schema.html#DLD-pools-in-conf-schema-lspec">Logical Specifications</a></li>
<li><a class="el" href="../../db/dce/_d_l_d-pools-in-conf-schema.html#DLD-pools-in-conf-schema-ut">Unit Tests</a></li>
<li><a class="el" href="../../db/dce/_d_l_d-pools-in-conf-schema.html#DLD-pools-in-conf-schema-st">System Tests</a></li>
<li><a class="el" href="../../db/dce/_d_l_d-pools-in-conf-schema.html#DLD-pools-in-conf-schema-ref">References</a></li>
</ul>
<hr/>
 <h1><a class="anchor" id="DLD-pools-in-conf-schema-ovw"></a>
Overview</h1>
<p>Pools are used to partition hardware resources (devices, servers). Pool versions are used to track changes in pool membership. User can combine multiple hardware resources to form a pool. Hardware resource can be member of multiple pools.</p>
<hr/>
 <h1><a class="anchor" id="DLD-pools-in-conf-schema-def"></a>
Definitions</h1>
<p><b>Pool</b> is a set of hardware resources.<br />
<b>Pool Version</b> Change set for pool.<br />
<b>Failure Set</b> Set of failed hardware resources.<br />
<b>Permutation set</b> Random combination sequence of hardware resources with same type.<br />
 </p><hr/>
 <h1><a class="anchor" id="DLD-pools-in-conf-schema-highlights"></a>
Design Highlights</h1>
<p>Hardware resources racks, enclosures &amp; controllers are arranged like tree structure. Leaves of this hardware resource tree are storage devices (disks).</p>
<p>Pool is a root node of this hardware resources tree. There may be multiple pools defined by user as per requirements.</p>
<p>In case of resources failure from particular pool, motr uses different variant of same pool called pool versions. There are multiple pool versions available with a pool. Every hardware resource maintains information about it's subscription with multiple pool versions.</p>
<p>Every file in motr is associated with a pool and pool version through file attributes assigned on creation of object. It uses user assigned default pool version OR in case of failure of some of devices in pool, it fetches pool version from configuration which does not contain failed resources.</p>
<p>A pool version is a tree of virtual objects corresponding to hardware resources, viz:- rackv, enclv, crtlv and sdevv. Every virtual object is associated with its corresponding physical object.</p>
<hr/>
 <h1><a class="anchor" id="DLD-pools-in-conf-schema-req"></a>
Requirements</h1>
<p><b>r.conf.pool</b> Implementation must define pool in configuration schema and it's supporting operations.<br />
<b>r.conf.pool.pool_version</b> Implementation must define pool_version in configuration schema and it's supporting operations.<br />
<b>r.conf.pool.pool_version.layout</b> Pool_version stores distribution permutation along with other layout attributes, e.g. N, K, P.<br />
<b>r.conf.pool.pool_version_get</b> Implementation must provide an interface to efficiently find the next available pool version which does not intersect with failure set.</p>
<hr/>
 <h1><a class="anchor" id="DLD-pools-in-conf_schema-depends"></a>
Dependencies</h1>
<p><b>failure_domains.permutations</b> : Every pool version needs to keep failure permutations for hardware devices like racks, enclosure, controller etc. Failure domain implementation exports this interface and pool version add uses this interface to get permutations for each type of hardware resource.</p>
<hr/>
 <h1><a class="anchor" id="DLD-pools-in-conf-schema-fspecs"></a>
Functional Specifications</h1>
<h2><a class="anchor" id="DLD-pools-in-conf-schema-fspecs-data"></a>
Data Structures</h2>
<p><a class="el" href="../../d9/d5d/conf-fspec-obj.html#conf-fspec-obj-data">Data Structures</a> Defined as Configuration objects</p>
<h2><a class="anchor" id="DLD-pools-in-conf-schema-fspecs-if"></a>
Interfaces</h2>
<ul>
<li><a class="el" href="../../db/dc2/conf_2helpers_8c.html#aa826bda14553a326ba3170660c49a051">m0_conf_pver_get()</a></li>
</ul>
<hr/>
 <h1><a class="anchor" id="DLD-pools-in-conf-schema-lspec"></a>
Logical Specifications</h1>
<h2><a class="anchor" id="DLD-pools-in-conf-schema-lspec-pool_version-get"></a>
Get Pool_version</h2>
<p>Provides interface to find latest pool version which does not intersect with the failure set on configuration changes.</p>
<p>Following algorithm illustrates a simplistic implementation of m0_conf_pool_version_get(), </p><pre class="fragment"> 1) for each pool_version V in pool P
    - for each device D in failure set F
      - find configuration object O for D in confc
      - for each pool_version v in O.pool_versions
        - if v.fid == V.fid
          - Fetch next pool version and repeat from step 1
    - return V
</pre> <hr/>
 <h1><a class="anchor" id="DLD-pools-in-conf-schema-ut"></a>
Unit Tests</h1>
<ul>
<li>Test 01 : pool object add/read/delete</li>
<li>Test 02 : poolversion object add/read/delete</li>
<li>Test 03 : process object add/read/delete</li>
<li>Test 04 : rack object add/read/delete</li>
<li>Test 05 : enclosure object add/read/delete</li>
<li>Test 06 : controller object add/read/delete</li>
<li>Test 07 : sdev object add/read/delete</li>
<li>Test 08 : m0_conf_pool_version_get() with NULL failure_set</li>
<li>Test 09 : m0_conf_pool_version_get() with failure set not NULL single device failure</li>
<li>Test 10 : m0_conf_pool_version_get() with failure set not NULL multiple device failure</li>
</ul>
<hr/>
 <h1><a class="anchor" id="DLD-pools-in-conf-schema-st"></a>
System Tests</h1>
<ul>
<li>Test 01 : m0t1fs mount, NULL failure set Create file.</li>
<li>Test 02 : m0t1fs mount, Some devices reported failed (failure set != NULL). Create file. <hr/>
 </li>
</ul>
<h1><a class="anchor" id="DLD-pools-in-conf-schema-ref"></a>
References</h1>
<p>For documentation links, please refer to this file : doc/motr-design-doc-list.rst</p><ul>
<li>Pools in Configuration Schema </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d3/dd6/_d_l_d_i_x.html">Detailed Designs</a></li>
    <li class="footer">Generated on Thu Apr 14 2022 14:03:22 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
