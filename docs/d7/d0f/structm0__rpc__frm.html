<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: m0_rpc_frm Struct Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d7/d0f/structm0__rpc__frm.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">m0_rpc_frm Struct Reference<div class="ingroups"><a class="el" href="../../db/de9/group__rpc.html">RPC</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for m0_rpc_frm:</div>
<div class="dyncontent">
<div class="center"><img src="../../d6/d18/structm0__rpc__frm__coll__graph.png" border="0" usemap="#m0__rpc__frm_coll__map" alt="Collaboration graph"/></div>
<map name="m0__rpc__frm_coll__map" id="m0__rpc__frm_coll__map">
<area shape="rect" id="node4" href="../../dc/dc5/structm0__rpc__frm__constraints.html" title="{m0_rpc_frm_constraints\n||}" alt="" coords="189,219,351,296"/>
<area shape="rect" id="node5" href="../../d4/d8a/structm0__tl.html" title="{m0_tl\n||}" alt="" coords="376,219,431,296"/>
<area shape="rect" id="node3" href="../../d3/d58/structm0__rpc__frm__ops.html" title="{m0_rpc_frm_ops\n||}" alt="" coords="455,219,573,296"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:afe2b977bb7716ce880ee2be1cc5457c5"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="../../db/de9/group__rpc.html#gaed8712abde4ca62d852e8c92b3ed6c65">frm_state</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d0f/structm0__rpc__frm.html#afe2b977bb7716ce880ee2be1cc5457c5">f_state</a></td></tr>
<tr class="separator:afe2b977bb7716ce880ee2be1cc5457c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ec7aedb9dc20e10744462bc78f156ee"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d4/d8a/structm0__tl.html">m0_tl</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d0f/structm0__rpc__frm.html#a6ec7aedb9dc20e10744462bc78f156ee">f_itemq</a> [<a class="el" href="../../db/de9/group__rpc.html#gga729f61af4d0d043bf87d0d26e1219c8ca6183c96b46926c421646c650537b762f">FRMQ_NR_QUEUES</a>]</td></tr>
<tr class="separator:a6ec7aedb9dc20e10744462bc78f156ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e611da623b3097303cc4b51737b4685"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d0f/structm0__rpc__frm.html#a7e611da623b3097303cc4b51737b4685">f_nr_items</a></td></tr>
<tr class="separator:a7e611da623b3097303cc4b51737b4685"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af487a98a761a9c5ead9fa3002324c29e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d49/types_8h.html#a754ca36f0e1fff3edef4f267024b1a1f">m0_bcount_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d0f/structm0__rpc__frm.html#af487a98a761a9c5ead9fa3002324c29e">f_nr_bytes_accumulated</a></td></tr>
<tr class="separator:af487a98a761a9c5ead9fa3002324c29e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43d77aa5bd38d544c48aef8b66028600"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d0f/structm0__rpc__frm.html#a43d77aa5bd38d544c48aef8b66028600">f_nr_packets_enqed</a></td></tr>
<tr class="separator:a43d77aa5bd38d544c48aef8b66028600"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9baecbf4b1635f0f624b66f17ab164b"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dc/dc5/structm0__rpc__frm__constraints.html">m0_rpc_frm_constraints</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d0f/structm0__rpc__frm.html#ac9baecbf4b1635f0f624b66f17ab164b">f_constraints</a></td></tr>
<tr class="separator:ac9baecbf4b1635f0f624b66f17ab164b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a491f94ad9c0c7eddbd8829c0aa820533"><td class="memItemLeft" align="right" valign="top">const struct <a class="el" href="../../d3/d58/structm0__rpc__frm__ops.html">m0_rpc_frm_ops</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d0f/structm0__rpc__frm.html#a491f94ad9c0c7eddbd8829c0aa820533">f_ops</a></td></tr>
<tr class="separator:a491f94ad9c0c7eddbd8829c0aa820533"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5501bfa53a8341bc4fb97a485ab898e3"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d0f/structm0__rpc__frm.html#a5501bfa53a8341bc4fb97a485ab898e3">f_magic</a></td></tr>
<tr class="separator:a5501bfa53a8341bc4fb97a485ab898e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Formation state machine.</p>
<p>There is one instance of <a class="el" href="../../d7/d0f/structm0__rpc__frm.html">m0_rpc_frm</a> for each destination end-point.</p>
<p>Events in which the formation state machine is interested are:</p><ul>
<li>RPC item is posted for sending</li>
<li>RPC packet has been sent or packet sending is failed</li>
<li>deadline timer of WAITING item is expired</li>
</ul>
<p>Events that formation machine triggers for rest of RPC are:</p><ul>
<li>Packet is ready for sending</li>
</ul>
<pre class="fragment">                FRM_UNINITIALISED
                      |  ^
     m0_rpc_frm_init()|  |
                      |  | m0_rpc_frm_fini()
                      V  |
                    FRM_IDLE
                      |  ^
 m0_rpc_frm_enq_item()|  | frm_itemq_remove() or m0_rpc_frm_packet_done()
   [frm_is_idle()]    |  | [!frm_is_idle()]
                      V  |
                    FRM_BUSY
</pre><p><b>Concurrency and Existence: </b> <br />
 Access to <a class="el" href="../../d7/d0f/structm0__rpc__frm.html">m0_rpc_frm</a> instance is synchronised by m0_rpc_machine::rm_sm_grp::s_lock.</p>
<p><a class="el" href="../../d7/d0f/structm0__rpc__frm.html">m0_rpc_frm</a> is not reference counted. It is responsibility of user to free <a class="el" href="../../d7/d0f/structm0__rpc__frm.html">m0_rpc_frm</a>. Ensuring that <a class="el" href="../../d7/d0f/structm0__rpc__frm.html">m0_rpc_frm</a> is in IDLE state, before finalising it, is left to user.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../db/de9/group__rpc.html#ga2124b5ee88d7b1754e8b6dbd18260b4f">frm_invariant()</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html#l00194">194</a> of file <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a>.</p>
</div><h2 class="groupheader">Field Documentation</h2>
<a id="ac9baecbf4b1635f0f624b66f17ab164b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9baecbf4b1635f0f624b66f17ab164b">&#9670;&nbsp;</a></span>f_constraints</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dc/dc5/structm0__rpc__frm__constraints.html">m0_rpc_frm_constraints</a> f_constraints</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Limits that formation should respect </p>

<p class="definition">Definition at line <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html#l00228">228</a> of file <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a>.</p>

</div>
</div>
<a id="a6ec7aedb9dc20e10744462bc78f156ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ec7aedb9dc20e10744462bc78f156ee">&#9670;&nbsp;</a></span>f_itemq</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d4/d8a/structm0__tl.html">m0_tl</a> f_itemq[<a class="el" href="../../db/de9/group__rpc.html#gga729f61af4d0d043bf87d0d26e1219c8ca6183c96b46926c421646c650537b762f">FRMQ_NR_QUEUES</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Lists of items enqueued to Formation that are not yet added to any Packet. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="../../db/de9/group__rpc.html#ga729f61af4d0d043bf87d0d26e1219c8c">m0_rpc_frm_itemq_type</a> itemq are sorted by <a class="el" href="../../de/d21/structm0__rpc__item.html#a3ae39f060959ad6caee5989955861cbb">m0_rpc_item::ri_prio</a> (highest priority first). All items having equal priority are sorted by <a class="el" href="../../de/d21/structm0__rpc__item.html#ae0dbfba148f0dc5c9e19da9528dd2f43">m0_rpc_item::ri_deadline</a> (earlier first). An <a class="el" href="../../db/de9/group__rpc.html#gae944bcb72fdcfcfb06a9a27759eb347a">item</a> is removed from itemq immediately upon adding the <a class="el" href="../../db/de9/group__rpc.html#gae944bcb72fdcfcfb06a9a27759eb347a">item</a> to any <a class="el" href="../../df/de8/structpacket.html">packet</a>. link: <a class="el" href="../../de/d21/structm0__rpc__item.html#a787185271fdfb1442b7aeb3e1a54678d">m0_rpc_item::ri_iq_link</a> descriptor: itemq </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html#l00216">216</a> of file <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a>.</p>

</div>
</div>
<a id="a5501bfa53a8341bc4fb97a485ab898e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5501bfa53a8341bc4fb97a485ab898e3">&#9670;&nbsp;</a></span>f_magic</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t f_magic</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>FRM_MAGIC </p>

<p class="definition">Definition at line <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html#l00233">233</a> of file <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a>.</p>

</div>
</div>
<a id="af487a98a761a9c5ead9fa3002324c29e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af487a98a761a9c5ead9fa3002324c29e">&#9670;&nbsp;</a></span>f_nr_bytes_accumulated</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d49/types_8h.html#a754ca36f0e1fff3edef4f267024b1a1f">m0_bcount_t</a> f_nr_bytes_accumulated</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sum of on-wire size of all the items in itemq </p>

<p class="definition">Definition at line <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html#l00222">222</a> of file <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a>.</p>

</div>
</div>
<a id="a7e611da623b3097303cc4b51737b4685"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e611da623b3097303cc4b51737b4685">&#9670;&nbsp;</a></span>f_nr_items</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t f_nr_items</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Total number of items waiting in itemq </p>

<p class="definition">Definition at line <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html#l00219">219</a> of file <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a>.</p>

</div>
</div>
<a id="a43d77aa5bd38d544c48aef8b66028600"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43d77aa5bd38d544c48aef8b66028600">&#9670;&nbsp;</a></span>f_nr_packets_enqed</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t f_nr_packets_enqed</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Number of packets for which "Packet done" callback is pending </p>

<p class="definition">Definition at line <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html#l00225">225</a> of file <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a>.</p>

</div>
</div>
<a id="a491f94ad9c0c7eddbd8829c0aa820533"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a491f94ad9c0c7eddbd8829c0aa820533">&#9670;&nbsp;</a></span>f_ops</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../d3/d58/structm0__rpc__frm__ops.html">m0_rpc_frm_ops</a>* f_ops</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html#l00230">230</a> of file <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a>.</p>

</div>
</div>
<a id="afe2b977bb7716ce880ee2be1cc5457c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe2b977bb7716ce880ee2be1cc5457c5">&#9670;&nbsp;</a></span>f_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../db/de9/group__rpc.html#gaed8712abde4ca62d852e8c92b3ed6c65">frm_state</a> f_state</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Current state.</p>
<p>Note: Because of very simple nature of formation state machine, currently we are not using generic sm framework. If need arises in future, we should implement formation state machine using <a class="el" href="../../db/d49/structm0__sm.html">m0_sm</a> framework. </p>

<p class="definition">Definition at line <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html#l00203">203</a> of file <a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>rpc/<a class="el" href="../../d2/d1f/formation2__internal_8h_source.html">formation2_internal.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d7/d0f/structm0__rpc__frm.html">m0_rpc_frm</a></li>
    <li class="footer">Generated on Thu Apr 14 2022 14:04:04 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
