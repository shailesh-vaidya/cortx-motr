<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: Layout DB</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d0/da2/group___layout_d_b_d_f_s.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Layout DB</div>  </div>
</div><!--header-->
<div class="contents">

<p>Detailed functional specification for Layout DB.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6c4bdca167e29cb8af224db83344a0ee"><td class="memItemLeft" align="right" valign="top">M0_INTERNAL int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/da2/group___layout_d_b_d_f_s.html#ga6c4bdca167e29cb8af224db83344a0ee">m0_layout_lookup</a> (struct <a class="el" href="../../dc/ddb/structm0__layout__domain.html">m0_layout_domain</a> *<a class="el" href="../../d9/d6a/group__stob.html#ga6b9f7e6115c241d0a8ea3087490f1043">dom</a>, uint64_t lid, struct <a class="el" href="../../da/d8a/structm0__layout__type.html">m0_layout_type</a> *lt, struct m0_db_tx *tx, struct m0_db_pair *<a class="el" href="../../df/de8/structpair.html">pair</a>, struct <a class="el" href="../../d9/dc1/structm0__layout.html">m0_layout</a> **<a class="el" href="../../dd/d6d/group__xcode.html#ga50fe33eaae68b43814656f241a6ac907">out</a>)</td></tr>
<tr class="separator:ga6c4bdca167e29cb8af224db83344a0ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga58b398d62d1e1fdd2e02104e579dd1ea"><td class="memItemLeft" align="right" valign="top">M0_INTERNAL int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/da2/group___layout_d_b_d_f_s.html#ga58b398d62d1e1fdd2e02104e579dd1ea">m0_layout_add</a> (struct <a class="el" href="../../d9/dc1/structm0__layout.html">m0_layout</a> *<a class="el" href="../../de/d2a/ut_2chan_8c.html#ad37acb21981ef5d222311efa6898eb14">l</a>, struct m0_db_tx *tx, struct m0_db_pair *<a class="el" href="../../df/de8/structpair.html">pair</a>)</td></tr>
<tr class="separator:ga58b398d62d1e1fdd2e02104e579dd1ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga41eeb702bda6b26afbe8782ac535a15b"><td class="memItemLeft" align="right" valign="top">M0_INTERNAL int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/da2/group___layout_d_b_d_f_s.html#ga41eeb702bda6b26afbe8782ac535a15b">m0_layout_update</a> (struct <a class="el" href="../../d9/dc1/structm0__layout.html">m0_layout</a> *<a class="el" href="../../de/d2a/ut_2chan_8c.html#ad37acb21981ef5d222311efa6898eb14">l</a>, struct m0_db_tx *tx, struct m0_db_pair *<a class="el" href="../../df/de8/structpair.html">pair</a>)</td></tr>
<tr class="separator:ga41eeb702bda6b26afbe8782ac535a15b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2ac08c2c74db2388f863b4bfa7a5a0d6"><td class="memItemLeft" align="right" valign="top">M0_INTERNAL int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/da2/group___layout_d_b_d_f_s.html#ga2ac08c2c74db2388f863b4bfa7a5a0d6">m0_layout_delete</a> (struct <a class="el" href="../../d9/dc1/structm0__layout.html">m0_layout</a> *<a class="el" href="../../de/d2a/ut_2chan_8c.html#ad37acb21981ef5d222311efa6898eb14">l</a>, struct m0_db_tx *tx, struct m0_db_pair *<a class="el" href="../../df/de8/structpair.html">pair</a>)</td></tr>
<tr class="separator:ga2ac08c2c74db2388f863b4bfa7a5a0d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7d2dcd4f1f9dc9ec3ab80c736ec4cc10"><td class="memItemLeft" align="right" valign="top">M0_INTERNAL void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/da2/group___layout_d_b_d_f_s.html#ga7d2dcd4f1f9dc9ec3ab80c736ec4cc10">m0_layout_pair_set</a> (struct m0_db_pair *<a class="el" href="../../df/de8/structpair.html">pair</a>, uint64_t *lid, void *area, <a class="el" href="../../d9/d49/types_8h.html#a754ca36f0e1fff3edef4f267024b1a1f">m0_bcount_t</a> num_bytes)</td></tr>
<tr class="separator:ga7d2dcd4f1f9dc9ec3ab80c736ec4cc10"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Detailed functional specification for Layout DB. </p>
<p>Detailed functional specification provides documentation of all the data structures and interfaces (internal and external).</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d8/de8/_layout-_d_b.html">Layout DB DLD</a> and its <a class="el" href="../../dd/d61/_layout-_d_b-fspec.html">Layout DB Functional Specification</a>. </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga58b398d62d1e1fdd2e02104e579dd1ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga58b398d62d1e1fdd2e02104e579dd1ea">&#9670;&nbsp;</a></span>m0_layout_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M0_INTERNAL int m0_layout_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d9/dc1/structm0__layout.html">m0_layout</a> *&#160;</td>
          <td class="paramname"><em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct m0_db_tx *&#160;</td>
          <td class="paramname"><em>tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct m0_db_pair *&#160;</td>
          <td class="paramname"><em>pair</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Adds a new layout record entry into the layouts table. If applicable, adds layout type and enum type specific entries into the relevant tables.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pair</td><td>A m0_db_pair sent by the caller along with having set pair-&gt;dp_key.db_buf and pair-&gt;dp_rec.db_buf. This is to leave the buffer allocation with the caller.</td></tr>
  </table>
  </dd>
</dl>
<p>Regarding the size of the pair-&gt;dp_rec.db_buf: The buffer size should be large enough to contain the data that is to be written specifically to the layouts table. It means it needs to be at the most the size returned by <a class="el" href="../../da/da8/group__layout.html#ga05d31297983b14bdffb168866dfc7624">m0_layout_max_recsize()</a>. </p>

<p class="definition">Definition at line <a class="el" href="../../da/df3/layout__db_8c_source.html#l00542">542</a> of file <a class="el" href="../../da/df3/layout__db_8c_source.html">layout_db.c</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/da2/group___layout_d_b_d_f_s_ga58b398d62d1e1fdd2e02104e579dd1ea_cgraph.png" border="0" usemap="#d0/da2/group___layout_d_b_d_f_s_ga58b398d62d1e1fdd2e02104e579dd1ea_cgraph" alt=""/></div>
<map name="d0/da2/group___layout_d_b_d_f_s_ga58b398d62d1e1fdd2e02104e579dd1ea_cgraph" id="d0/da2/group___layout_d_b_d_f_s_ga58b398d62d1e1fdd2e02104e579dd1ea_cgraph">
<area shape="rect" id="node2" href="../../da/da8/group__layout.html#gaf16fef6180ff8f3f32a3f984913558e3" title="m0_layout__invariant" alt="" coords="164,5,309,32"/>
<area shape="rect" id="node3" href="../../d0/d04/group__mutex.html#gae26efdb3a765f750c5992041d6ee2336" title="m0_mutex_lock" alt="" coords="179,56,294,83"/>
<area shape="rect" id="node4" href="../../d5/da3/group___layout_d_b_d_f_s_internal.html#ga7efa13a10d975c5a9a3a52208a11c053" title="pair_init" alt="" coords="203,157,270,184"/>
<area shape="rect" id="node5" href="../../da/da8/group__layout.html#ga9e15dc29aa4b0356b209342bcddcdc2e" title="m0_layout__log" alt="" coords="357,132,471,159"/>
<area shape="rect" id="node6" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#a9a02a790ad457506f9f3bc12121e6079" title="M0_RC" alt="" coords="381,183,447,209"/>
<area shape="rect" id="node7" href="../../d0/d04/group__mutex.html#ga18963570792098f5ab3cf3e8ede8046a" title="m0_mutex_unlock" alt="" coords="173,259,301,285"/>
<area shape="rect" id="node8" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#ad1c2b8b0cf1cc0d319e690c0bef9569e" title="M0_LEAVE" alt="" coords="192,309,281,336"/>
</map>
</div>

</div>
</div>
<a id="ga2ac08c2c74db2388f863b4bfa7a5a0d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2ac08c2c74db2388f863b4bfa7a5a0d6">&#9670;&nbsp;</a></span>m0_layout_delete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M0_INTERNAL int m0_layout_delete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d9/dc1/structm0__layout.html">m0_layout</a> *&#160;</td>
          <td class="paramname"><em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct m0_db_tx *&#160;</td>
          <td class="paramname"><em>tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct m0_db_pair *&#160;</td>
          <td class="paramname"><em>pair</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Deletes a layout record with given layout id and its related information from the relevant tables.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pair</td><td>A m0_db_pair sent by the caller along with having set pair-&gt;dp_key.db_buf and pair-&gt;dp_rec.db_buf. This is to leave the buffer allocation with the caller.</td></tr>
  </table>
  </dd>
</dl>
<p>Regarding the size of the pair-&gt;dp_rec.db_buf: The buffer size should be large enough to contain the data that is to be written specifically to the layouts table. It means it needs to be at the most the size returned by <a class="el" href="../../da/da8/group__layout.html#ga05d31297983b14bdffb168866dfc7624">m0_layout_max_recsize()</a>. </p>

<p class="definition">Definition at line <a class="el" href="../../da/df3/layout__db_8c_source.html#l00601">601</a> of file <a class="el" href="../../da/df3/layout__db_8c_source.html">layout_db.c</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/da2/group___layout_d_b_d_f_s_ga2ac08c2c74db2388f863b4bfa7a5a0d6_cgraph.png" border="0" usemap="#d0/da2/group___layout_d_b_d_f_s_ga2ac08c2c74db2388f863b4bfa7a5a0d6_cgraph" alt=""/></div>
<map name="d0/da2/group___layout_d_b_d_f_s_ga2ac08c2c74db2388f863b4bfa7a5a0d6_cgraph" id="d0/da2/group___layout_d_b_d_f_s_ga2ac08c2c74db2388f863b4bfa7a5a0d6_cgraph">
<area shape="rect" id="node2" href="../../da/da8/group__layout.html#gaf16fef6180ff8f3f32a3f984913558e3" title="m0_layout__invariant" alt="" coords="177,5,323,32"/>
<area shape="rect" id="node3" href="../../d0/d04/group__mutex.html#gae26efdb3a765f750c5992041d6ee2336" title="m0_mutex_lock" alt="" coords="193,56,307,83"/>
<area shape="rect" id="node4" href="../../d0/d04/group__mutex.html#ga18963570792098f5ab3cf3e8ede8046a" title="m0_mutex_unlock" alt="" coords="186,107,314,133"/>
<area shape="rect" id="node5" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#a01283f6c481bc4a3d0f204e957179d6e" title="M0_ERR" alt="" coords="212,157,288,184"/>
<area shape="rect" id="node6" href="../../d5/da3/group___layout_d_b_d_f_s_internal.html#ga7efa13a10d975c5a9a3a52208a11c053" title="pair_init" alt="" coords="217,259,283,285"/>
<area shape="rect" id="node7" href="../../da/da8/group__layout.html#ga9e15dc29aa4b0356b209342bcddcdc2e" title="m0_layout__log" alt="" coords="371,233,484,260"/>
<area shape="rect" id="node8" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#a9a02a790ad457506f9f3bc12121e6079" title="M0_RC" alt="" coords="394,284,461,311"/>
<area shape="rect" id="node9" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#ad1c2b8b0cf1cc0d319e690c0bef9569e" title="M0_LEAVE" alt="" coords="205,360,295,387"/>
</map>
</div>

</div>
</div>
<a id="ga6c4bdca167e29cb8af224db83344a0ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6c4bdca167e29cb8af224db83344a0ee">&#9670;&nbsp;</a></span>m0_layout_lookup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M0_INTERNAL int m0_layout_lookup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/ddb/structm0__layout__domain.html">m0_layout_domain</a> *&#160;</td>
          <td class="paramname"><em>dom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>lid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../da/d8a/structm0__layout__type.html">m0_layout_type</a> *&#160;</td>
          <td class="paramname"><em>lt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct m0_db_tx *&#160;</td>
          <td class="paramname"><em>tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct m0_db_pair *&#160;</td>
          <td class="paramname"><em>pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d9/dc1/structm0__layout.html">m0_layout</a> **&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Looks for an in-memory layout object with the given identifier in the list of layout objects maintained in the layout domain. If not found there, looks up for a persistent layout record in the layout DB with the given identifier. If present in the layout DB, prepares an in-memory layout object with the information from the DB and adds the layout object to the list of layout objects in the layout domain.</p>
<p>All operations are performed in the context of the caller-supplied transaction.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pair</td><td>A m0_db_pair sent by the caller along with having set pair-&gt;dp_key.db_buf and pair-&gt;dp_rec.db_buf. This is to leave the buffer allocation with the caller.</td></tr>
  </table>
  </dd>
</dl>
<p>Regarding the size of the pair-&gt;dp_rec.db_buf: The buffer size should be large enough to contain the data that is to be read specifically from the layouts table. It means it needs to be at the most the size returned by <a class="el" href="../../da/da8/group__layout.html#ga05d31297983b14bdffb168866dfc7624">m0_layout_max_recsize()</a>. It is no harm if it is bigger than that.</p>
<dl class="section post"><dt>Postcondition</dt><dd><ul>
<li>Returns a layout object with the given identifier if it exists in the list of the layout objects maintained in the layout domain.</li>
<li>If it does not exist in that list, then it read from the database. If its entry exists in the database, then using it, a new layout object is built internally (along with enumeration object being built if applicable).</li>
<li>In case of successful return, an additional reference is acquired on the layout object returned in the variable "out". </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/df3/layout__db_8c_source.html#l00428">428</a> of file <a class="el" href="../../da/df3/layout__db_8c_source.html">layout_db.c</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/da2/group___layout_d_b_d_f_s_ga6c4bdca167e29cb8af224db83344a0ee_cgraph.png" border="0" usemap="#d0/da2/group___layout_d_b_d_f_s_ga6c4bdca167e29cb8af224db83344a0ee_cgraph" alt=""/></div>
<map name="d0/da2/group___layout_d_b_d_f_s_ga6c4bdca167e29cb8af224db83344a0ee_cgraph" id="d0/da2/group___layout_d_b_d_f_s_ga6c4bdca167e29cb8af224db83344a0ee_cgraph">
<area shape="rect" id="node2" href="../../d0/d9e/group__addb2.html#ga7be2f145dc9b5b3220c69a52f0409b25" title="cur" alt="" coords="661,65,701,91"/>
<area shape="rect" id="node3" href="../../da/da8/group__layout.html#ga97e1269652f182993a4945448635e1ea" title="m0_layout__domain_invariant" alt="" coords="391,521,585,547"/>
<area shape="rect" id="node4" href="../../da/da8/group__layout.html#ga9e15dc29aa4b0356b209342bcddcdc2e" title="m0_layout__log" alt="" coords="431,141,545,167"/>
<area shape="rect" id="node5" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#a01283f6c481bc4a3d0f204e957179d6e" title="M0_ERR" alt="" coords="450,293,526,319"/>
<area shape="rect" id="node6" href="../../d0/d04/group__mutex.html#gae26efdb3a765f750c5992041d6ee2336" title="m0_mutex_lock" alt="" coords="204,597,319,623"/>
<area shape="rect" id="node7" href="../../da/da8/group__layout.html#ga97e9945db9f8653f97cadfa3fdf4f1ff" title="m0_layout__list_lookup" alt="" coords="182,647,341,674"/>
<area shape="rect" id="node8" href="../../d0/d04/group__mutex.html#ga18963570792098f5ab3cf3e8ede8046a" title="m0_mutex_unlock" alt="" coords="197,698,325,725"/>
<area shape="rect" id="node9" href="../../da/da8/group__layout.html#gaf16fef6180ff8f3f32a3f984913558e3" title="m0_layout__invariant" alt="" coords="415,343,561,370"/>
<area shape="rect" id="node10" href="../../d4/de4/refs_8c.html#a7954d6835d9a918376dadcfbdffe0b19" title="m0_ref_read" alt="" coords="633,394,728,421"/>
<area shape="rect" id="node11" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#ad1c2b8b0cf1cc0d319e690c0bef9569e" title="M0_LEAVE" alt="" coords="443,394,533,421"/>
<area shape="rect" id="node12" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#a9a02a790ad457506f9f3bc12121e6079" title="M0_RC" alt="" coords="455,191,521,218"/>
<area shape="rect" id="node13" href="../../da/da8/group__layout.html#ga05d31297983b14bdffb168866dfc7624" title="m0_layout_max_recsize" alt="" coords="180,495,343,522"/>
<area shape="rect" id="node14" href="../../d5/da3/group___layout_d_b_d_f_s_internal.html#ga7efa13a10d975c5a9a3a52208a11c053" title="pair_init" alt="" coords="228,141,295,167"/>
<area shape="rect" id="node15" href="../../d0/d7f/group__vec.html#ga25676feab636093b10797af188337efc" title="m0_bufvec_cursor_init" alt="" coords="411,65,565,91"/>
<area shape="rect" id="node16" href="../../da/da8/group__layout.html#ga2a19253d39ad85f5d29e837a16280dad" title="m0_layout_decode" alt="" coords="196,242,327,269"/>
</map>
</div>

</div>
</div>
<a id="ga7d2dcd4f1f9dc9ec3ab80c736ec4cc10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7d2dcd4f1f9dc9ec3ab80c736ec4cc10">&#9670;&nbsp;</a></span>m0_layout_pair_set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M0_INTERNAL void m0_layout_pair_set </td>
          <td>(</td>
          <td class="paramtype">struct m0_db_pair *&#160;</td>
          <td class="paramname"><em>pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>lid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>area</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d49/types_8h.html#a754ca36f0e1fff3edef4f267024b1a1f">m0_bcount_t</a>&#160;</td>
          <td class="paramname"><em>num_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/df3/layout__db_8c_source.html#l00370">370</a> of file <a class="el" href="../../da/df3/layout__db_8c_source.html">layout_db.c</a>.</p>

</div>
</div>
<a id="ga41eeb702bda6b26afbe8782ac535a15b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga41eeb702bda6b26afbe8782ac535a15b">&#9670;&nbsp;</a></span>m0_layout_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M0_INTERNAL int m0_layout_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d9/dc1/structm0__layout.html">m0_layout</a> *&#160;</td>
          <td class="paramname"><em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct m0_db_tx *&#160;</td>
          <td class="paramname"><em>tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct m0_db_pair *&#160;</td>
          <td class="paramname"><em>pair</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Updates a layout record from the DB. The only field that can be updated for an existing layout in the layout DB is its user count. It is not prevented through the implementation to update any other fields since it was found to be costly through performance perspective.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pair</td><td>A m0_db_pair sent by the caller along with having set pair-&gt;dp_key.db_buf and pair-&gt;dp_rec.db_buf. This is to leave the buffer allocation with the caller.</td></tr>
  </table>
  </dd>
</dl>
<p>Regarding the size of the pair-&gt;dp_rec.db_buf: The buffer size should be large enough to contain the data that is to be written specifically to the layouts table. It means it needs to be at the most the size returned by <a class="el" href="../../da/da8/group__layout.html#ga05d31297983b14bdffb168866dfc7624">m0_layout_max_recsize()</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Even a non-existing record can be written to the database using the database update operation. In other words, not using <a class="el" href="../../da/da8/group__layout.html#gac96ddacece5f7288b9e71ccddddc2542">m0_layout_add()</a> and directly using <a class="el" href="../../d0/da2/group___layout_d_b_d_f_s.html#ga41eeb702bda6b26afbe8782ac535a15b">m0_layout_update()</a> results into the layout record being written to the DB. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/df3/layout__db_8c_source.html#l00570">570</a> of file <a class="el" href="../../da/df3/layout__db_8c_source.html">layout_db.c</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/da2/group___layout_d_b_d_f_s_ga41eeb702bda6b26afbe8782ac535a15b_cgraph.png" border="0" usemap="#d0/da2/group___layout_d_b_d_f_s_ga41eeb702bda6b26afbe8782ac535a15b_cgraph" alt=""/></div>
<map name="d0/da2/group___layout_d_b_d_f_s_ga41eeb702bda6b26afbe8782ac535a15b_cgraph" id="d0/da2/group___layout_d_b_d_f_s_ga41eeb702bda6b26afbe8782ac535a15b_cgraph">
<area shape="rect" id="node2" href="../../da/da8/group__layout.html#gaf16fef6180ff8f3f32a3f984913558e3" title="m0_layout__invariant" alt="" coords="181,5,327,32"/>
<area shape="rect" id="node3" href="../../d0/d04/group__mutex.html#gae26efdb3a765f750c5992041d6ee2336" title="m0_mutex_lock" alt="" coords="197,56,311,83"/>
<area shape="rect" id="node4" href="../../d5/da3/group___layout_d_b_d_f_s_internal.html#ga7efa13a10d975c5a9a3a52208a11c053" title="pair_init" alt="" coords="221,157,287,184"/>
<area shape="rect" id="node5" href="../../da/da8/group__layout.html#ga9e15dc29aa4b0356b209342bcddcdc2e" title="m0_layout__log" alt="" coords="375,132,488,159"/>
<area shape="rect" id="node6" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#a9a02a790ad457506f9f3bc12121e6079" title="M0_RC" alt="" coords="398,183,465,209"/>
<area shape="rect" id="node7" href="../../d0/d04/group__mutex.html#ga18963570792098f5ab3cf3e8ede8046a" title="m0_mutex_unlock" alt="" coords="190,259,318,285"/>
<area shape="rect" id="node8" href="../../db/dcd/m0t1fs_2linux__kernel_2dir_8c.html#ad1c2b8b0cf1cc0d319e690c0bef9569e" title="M0_LEAVE" alt="" coords="209,309,299,336"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Apr 14 2022 14:03:41 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
