<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motr: IO FOL DLD</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motr
   &#160;<span id="projectnumber">M0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('de/d70/_i_o_f_o_l_d_l_d.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">IO FOL DLD </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="../../de/d70/_i_o_f_o_l_d_l_d.html#IOFOLDLD-ovw">Overview</a></li>
<li><a class="el" href="../../de/d70/_i_o_f_o_l_d_l_d.html#IOFOLDLD-def">Definitions</a></li>
<li><a class="el" href="../../de/d70/_i_o_f_o_l_d_l_d.html#IOFOLDLD-req">Requirements</a></li>
<li><a class="el" href="../../de/d70/_i_o_f_o_l_d_l_d.html#IOFOLDLD-depends">Dependencies</a></li>
<li><a class="el" href="../../de/d70/_i_o_f_o_l_d_l_d.html#IOFOLDLD-highlights">Design Highlights</a></li>
<li><a class="el" href="../../de/d70/_i_o_f_o_l_d_l_d.html#IOFOLDLD-fspec">Functional Specification</a></li>
<li>IOFOLDLD-lspec</li>
<li><a class="el" href="../../de/d70/_i_o_f_o_l_d_l_d.html#IOFOLDLD-ut">Unit Tests</a></li>
<li><a class="el" href="../../de/d70/_i_o_f_o_l_d_l_d.html#IOFOLDLD-st">System Tests</a></li>
<li><a class="el" href="../../de/d70/_i_o_f_o_l_d_l_d.html#IOFOLDLD-O">Analysis</a></li>
<li>IOFOLDLD-ref</li>
</ul>
<hr/>
 <h1><a class="anchor" id="IOFOLDLD-ovw"></a>
Overview</h1>
<p>This document describes the design of logging of FOL records for create, delete and write operations in ioservice.</p>
<hr/>
 <h1><a class="anchor" id="IOFOLDLD-def"></a>
Definitions</h1>
<hr/>
 <h1><a class="anchor" id="IOFOLDLD-req"></a>
Requirements</h1>
<hr/>
 <h1><a class="anchor" id="IOFOLDLD-depends"></a>
Dependencies</h1>
<p>For every new write data must be written to new block. So that these older data blocks can be used to perform write undo. </p><hr/>
 <h1><a class="anchor" id="IOFOLDLD-highlights"></a>
Design Highlights</h1>
<p>For each update made on server corresponding FOL record fragment is populated and added in the FOM transaction FOL record fragments list.</p>
<p>These FOL record fragments are encoded in a single FOL record in a FOM generic phase after updates are executed.</p>
<hr/>
 <h1><a class="anchor" id="IOFOLDLD-fspec"></a>
Functional Specification</h1>
<dl class="section see"><dt>See also</dt><dd>ad_rec_frag is <a class="el" href="../../dc/de2/base_8c.html#a518dc951712ff1f919a3af4897ef91b9">added</a> for AD write operation.</dd></dl>
<p>For each of create, delete and write IO operations FOL record fragments are added in FOM generic phase M0_FOPH_FOL_FRAG_ADD using <a class="el" href="../../d6/d39/group__fop.html#gaf9de478f142a6b6a5f2b015c76aef119">m0_fop_fol_add()</a>.</p>
<p>For create and delete operations fop data and reply fop data is stored in FOL record fragments.</p><ul>
<li>fop data including fid.</li>
<li>Reply fop data is added in FOL records so that it can be used as Reply Cache.</li>
</ul>
<p>For write operation, in ad_write_launch() store AD allocated extents in FOL record fragment struct ad_rec_frag.</p>
<p>All these FOL record fragments are to the list in the transaction record.</p>
<hr/>
 <h1><a class="anchor" id="IOFOLDLD-ut"></a>
Unit Tests</h1>
<p>1) For create and delete updates, An io fop with a given fid is send to the ioservice, where it creates a cob with that fid and logs a FOL record.</p>
<p>Now retrieve that FOL record using the same LSN and assert for fid and reply fop data.</p>
<p>Also using this data, execute the cob delete operation on server side (undo operation).</p>
<p>Similarly, do the same things for delete operation.</p>
<p>2) For Write update, Send the data having value "A" from client to ioservice which logs fid and data extents in FOL record. Then send the data having value "B" to the ioservice.</p>
<p>Now retrieve the data extents of the first write operation from FOL record and update the AD table by decoding ad_rec_frag from FOL record. Then read the data from ioservice and assert for data "A".</p>
<hr/>
 <h1><a class="anchor" id="IOFOLDLD-st"></a>
System Tests</h1>
<hr/>
 <h1><a class="anchor" id="IOFOLDLD-O"></a>
Analysis</h1>
<p>For documentation links, please refer to this file : doc/motr-design-doc-list.rst</p><ul>
<li>HLD of version numbers</li>
<li>HLD of FOL</li>
<li>HLD of data block allocator</li>
<li><a class="el" href="../../d1/d12/group__fol.html">File operations log</a></li>
<li><a class="el" href="../../d6/d2c/group__stobad.html">Storage objects with extent maps.</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d3/dd6/_d_l_d_i_x.html">Detailed Designs</a></li>
    <li class="footer">Generated on Thu Apr 14 2022 14:03:25 for Motr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
